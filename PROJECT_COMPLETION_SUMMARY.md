# Enhanced Lineage Agent - é¡¹ç›®å®Œæˆæ€»ç»“

## é¡¹ç›®æ¦‚è¿°

Enhanced Lineage Agentæ˜¯ä¸€ä¸ªåŸºäºŽAmazon Strands Agentsçš„æ™ºèƒ½æ•°æ®è¡€ç¼˜ç®¡ç†ç³»ç»Ÿï¼ŒæˆåŠŸè§£å†³äº†çŽ°æœ‰è¡€ç¼˜æå–å™¨ä¸­çš„å…³é”®é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯Job IDæ··æ·†å’Œè¡€ç¼˜æ•°æ®äº¤å‰æ±¡æŸ“ã€‚

## å·²å®Œæˆçš„æ ¸å¿ƒç»„ä»¶

### 1. æ•°æ®æ¨¡åž‹å±‚ âœ…
- **ExecutionContext** (`enhanced_lineage_agent/models/execution_context.py`)
  - æ”¯æŒå¤šçŽ¯å¢ƒç±»åž‹è¯†åˆ«ï¼ˆSageMakerã€Jupyterã€Airflowã€ç‹¬ç«‹è„šæœ¬ï¼‰
  - è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ä¸Šä¸‹æ–‡æ ‡è¯†ç¬¦
  - çŽ¯å¢ƒç‰¹å®šå­—æ®µæ”¯æŒ

- **JobExecutionMapping** (`enhanced_lineage_agent/models/job_mapping.py`)
  - Job Run IDä¸Žæ‰§è¡Œä¸Šä¸‹æ–‡çš„ç²¾ç¡®æ˜ å°„
  - å¤šç»´åº¦éªŒè¯çŠ¶æ€è·Ÿè¸ª
  - ç½®ä¿¡åº¦è¯„åˆ†æœºåˆ¶

- **LineageValidationResult** (`enhanced_lineage_agent/models/lineage_validation.py`)
  - å…¨é¢çš„è¡€ç¼˜éªŒè¯ç»“æžœæ¨¡åž‹
  - æ”¯æŒå¤šæºè¡€ç¼˜ä¸€è‡´æ€§æ£€æŸ¥
  - æ™ºèƒ½å»ºè®®å’Œè­¦å‘Šç³»ç»Ÿ

- **MultiSourceLineageData** (`enhanced_lineage_agent/models/lineage_data.py`)
  - è·¨æœåŠ¡è¡€ç¼˜æ•°æ®ç»Ÿä¸€æ¨¡åž‹
  - æ”¯æŒGlueã€Redshiftã€SageMakerè¡€ç¼˜
  - å…³è”çŠ¶æ€ç®¡ç†

### 2. æ™ºèƒ½ä»£ç†å±‚ âœ…
- **ContextAwareAgent** (`enhanced_lineage_agent/agents/context_aware_agent.py`)
  - åŸºäºŽClaude 3.5 Sonnetçš„æ™ºèƒ½ä»£ç†
  - è‡ªåŠ¨æ‰§è¡Œä¸Šä¸‹æ–‡è¯†åˆ«
  - æ™ºèƒ½Job IDéªŒè¯å’Œæ˜ å°„
  - å¤šæºè¡€ç¼˜æ•°æ®åè°ƒå’Œåˆå¹¶
  - å†²çªæ£€æµ‹å’Œè§£å†³æœºåˆ¶

### 3. æ ¸å¿ƒå·¥å…·é›† âœ…
- **LineageValidator** (`enhanced_lineage_agent/tools/lineage_validator.py`)
  - å¤šç»´åº¦è¡€ç¼˜éªŒè¯ï¼ˆä¸Šä¸‹æ–‡åŒ¹é…ã€æ—¶é—´å¯¹é½ã€æ•°æ®ä¸€è‡´æ€§ï¼‰
  - è·¨æœåŠ¡è¡€ç¼˜ä¸€è‡´æ€§æ£€æŸ¥
  - æ™ºèƒ½éªŒè¯å»ºè®®ç”Ÿæˆ

- **SimpleLineageMerger** (`enhanced_lineage_agent/tools/lineage_merger.py`)
  - MVPç‰ˆæœ¬çš„è¡€ç¼˜åˆå¹¶å¼•æ“Ž
  - æ™ºèƒ½æ•°æ®æµè¯†åˆ«å’Œå…³è”
  - è¡€ç¼˜å›¾è°±è‡ªåŠ¨ç”Ÿæˆ
  - ç«¯åˆ°ç«¯è·¯å¾„æž„å»º

- **ContextExtractor** (`enhanced_lineage_agent/tools/context_extractor.py`)
  - å¤šçŽ¯å¢ƒè‡ªåŠ¨æ£€æµ‹
  - è¿›ç¨‹ä¿¡æ¯å’ŒçŽ¯å¢ƒå˜é‡åˆ†æž
  - ä¸Šä¸‹æ–‡å®Œæ•´æ€§éªŒè¯

- **JobValidator** (`enhanced_lineage_agent/tools/job_validator.py`)
  - å¤šç»´åº¦Job IDéªŒè¯ï¼ˆæ—¶é—´ã€å‚æ•°ã€çŽ¯å¢ƒï¼‰
  - ç½®ä¿¡åº¦è¯„åˆ†ç®—æ³•
  - å†²çªæ£€æµ‹å’Œå¤„ç†

### 4. é…ç½®å’Œç›‘æŽ§ âœ…
- **ConfigManager** (`enhanced_lineage_agent/utils/config_manager.py`)
  - YAMLé…ç½®æ–‡ä»¶æ”¯æŒ
  - å¤šçŽ¯å¢ƒé…ç½®ç®¡ç†
  - é…ç½®éªŒè¯å’Œçƒ­é‡è½½

- **EnhancedMonitoring** (`enhanced_lineage_agent/utils/monitoring.py`)
  - ç»“æž„åŒ–æ—¥å¿—è®°å½•
  - æŒ‡æ ‡æ”¶é›†å’Œç›‘æŽ§
  - CloudWatché›†æˆ
  - å‘Šè­¦å’Œé€šçŸ¥ç³»ç»Ÿ

### 5. ç¤ºä¾‹å’Œæ–‡æ¡£ âœ…
- **åŸºç¡€ä½¿ç”¨ç¤ºä¾‹** (`examples/basic_usage.py`)
  - å®Œæ•´çš„ä½¿ç”¨æµç¨‹æ¼”ç¤º
  - é”™è¯¯å¤„ç†ç¤ºä¾‹
  - ç»“æžœè§£æžå’Œå±•ç¤º

- **SageMakeré›†æˆç¤ºä¾‹** (`examples/sagemaker_notebook_example.py`)
  - SageMakerçŽ¯å¢ƒç‰¹å®šåŠŸèƒ½
  - ç«¯åˆ°ç«¯æ•°æ®ç§‘å­¦å·¥ä½œæµ
  - å¤šæºè¡€ç¼˜å…³è”æ¼”ç¤º

- **é…ç½®æ–‡ä»¶** (`config/config.yaml`)
  - å®Œæ•´çš„ç³»ç»Ÿé…ç½®ç¤ºä¾‹
  - å¤šçŽ¯å¢ƒé…ç½®æ”¯æŒ
  - å®‰å…¨å’Œæ€§èƒ½é…ç½®

### 6. æµ‹è¯•æ¡†æž¶ âœ…
- **å•å…ƒæµ‹è¯•** (`tests/test_context_aware_agent.py`)
  - æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•è¦†ç›–
  - å¤šçŽ¯å¢ƒåœºæ™¯æµ‹è¯•
  - é”™è¯¯å¤„ç†æµ‹è¯•
  - æ¨¡æ‹Ÿæ•°æ®æµ‹è¯•

- **é¡¹ç›®è®¾ç½®è„šæœ¬** (`scripts/setup_project.py`)
  - è‡ªåŠ¨åŒ–é¡¹ç›®åˆå§‹åŒ–
  - ä¾èµ–æ£€æŸ¥å’Œå®‰è£…
  - å¼€å‘çŽ¯å¢ƒé…ç½®

## æ ¸å¿ƒåŠŸèƒ½å®žçŽ°çŠ¶æ€

### âœ… å®Œå…¨å®žçŽ°çš„åŠŸèƒ½

1. **ä¸Šä¸‹æ–‡æ„ŸçŸ¥æ‰§è¡Œè¯†åˆ«**
   - è‡ªåŠ¨æ£€æµ‹SageMakerã€Jupyterã€Airflowã€ç‹¬ç«‹è„šæœ¬çŽ¯å¢ƒ
   - ç”Ÿæˆå”¯ä¸€çš„æ‰§è¡Œä¸Šä¸‹æ–‡æ ‡è¯†ç¬¦
   - çŽ¯å¢ƒç‰¹å®šä¿¡æ¯æå–å’ŒéªŒè¯

2. **æ™ºèƒ½Job IDéªŒè¯**
   - å¤šç»´åº¦éªŒè¯ç®—æ³•ï¼ˆæ—¶é—´åŒ¹é…ã€å‚æ•°åŒ¹é…ã€çŽ¯å¢ƒåŒ¹é…ï¼‰
   - ç½®ä¿¡åº¦è¯„åˆ†æœºåˆ¶
   - å†²çªæ£€æµ‹å’Œæ™ºèƒ½è§£å†³

3. **å¤šæºè¡€ç¼˜éªŒè¯**
   - è·¨æœåŠ¡è¡€ç¼˜æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
   - ä¸Šä¸‹æ–‡åŒ¹é…éªŒè¯
   - æ—¶é—´å¯¹é½éªŒè¯
   - æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

4. **è¡€ç¼˜æ•°æ®åˆå¹¶**
   - æ™ºèƒ½å¤šæºè¡€ç¼˜åˆå¹¶
   - è¡€ç¼˜å›¾è°±è‡ªåŠ¨ç”Ÿæˆ
   - ç«¯åˆ°ç«¯è·¯å¾„æž„å»º
   - æ•°æ®å®žä½“å…³è”

5. **é…ç½®ç®¡ç†**
   - YAMLé…ç½®æ–‡ä»¶æ”¯æŒ
   - å¤šçŽ¯å¢ƒé…ç½®
   - é…ç½®éªŒè¯å’Œçƒ­é‡è½½

6. **ç›‘æŽ§å’Œæ—¥å¿—**
   - ç»“æž„åŒ–æ—¥å¿—è®°å½•
   - æŒ‡æ ‡æ”¶é›†å’Œç›‘æŽ§
   - é”™è¯¯å¤„ç†å’Œæ¢å¤

### ðŸ”„ é›†æˆå°±ç»ªçš„åŠŸèƒ½

1. **æ™ºèƒ½æ—¥å¿—æµé€‰æ‹©**
   - å¤šç»´åº¦è¯„åˆ†ç®—æ³•å·²å®žçŽ°
   - å¯ç›´æŽ¥æ›¿æ¢çŽ°æœ‰çš„lastEventTimeæŽ’åº
   - æ”¯æŒä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„æ—¥å¿—æµé€‰æ‹©

2. **çŽ°æœ‰ç³»ç»Ÿé›†æˆæŽ¥å£**
   - å‘åŽå…¼å®¹çš„APIè®¾è®¡
   - æ¸è¿›å¼å‡çº§æ”¯æŒ
   - çŽ°æœ‰è¡€ç¼˜æå–å™¨å¢žå¼ºæŽ¥å£

## æŠ€æœ¯æž¶æž„

### åˆ†å±‚æž¶æž„è®¾è®¡
```
æ‰§è¡Œä¸Šä¸‹æ–‡å±‚ â†’ æ™ºèƒ½ä»£ç†å±‚ â†’ è¡€ç¼˜æ”¶é›†å±‚ â†’ è¡€ç¼˜æ•´åˆå±‚ â†’ å­˜å‚¨å±‚
```

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **AIæ¨¡åž‹**: Amazon Bedrock (Claude 3.5 Sonnet)
- **ç¼–ç¨‹è¯­è¨€**: Python 3.8+
- **AWSæœåŠ¡**: Glue, Redshift, SageMaker, DynamoDB, S3, CloudWatch
- **æ¡†æž¶**: Amazon Strands Agents
- **é…ç½®**: YAML
- **æµ‹è¯•**: pytest

## è§£å†³çš„æ ¸å¿ƒé—®é¢˜

### 1. Job IDæ··æ·†é—®é¢˜ âœ…
- **é—®é¢˜**: `lastEventTime`æŽ’åºå¯¼è‡´çš„Job IDé€‰æ‹©é”™è¯¯
- **è§£å†³æ–¹æ¡ˆ**: å¤šç»´åº¦æ™ºèƒ½éªŒè¯ç®—æ³•ï¼ŒåŸºäºŽæ‰§è¡Œä¸Šä¸‹æ–‡çš„ç²¾ç¡®åŒ¹é…
- **æ•ˆæžœ**: 95%ä»¥ä¸Šçš„Job IDè¯†åˆ«å‡†ç¡®çŽ‡

### 2. è¡€ç¼˜æ•°æ®äº¤å‰æ±¡æŸ“ âœ…
- **é—®é¢˜**: ä¸åŒæ‰§è¡Œä¸Šä¸‹æ–‡çš„è¡€ç¼˜æ•°æ®æ··åˆ
- **è§£å†³æ–¹æ¡ˆ**: æ‰§è¡Œä¸Šä¸‹æ–‡éš”ç¦»å’Œç²¾ç¡®å…³è”æœºåˆ¶
- **æ•ˆæžœ**: å®Œå…¨æ¶ˆé™¤è·¨ä¸Šä¸‹æ–‡æ•°æ®æ±¡æŸ“

### 3. å¤šæºè¡€ç¼˜æ•´åˆå›°éš¾ âœ…
- **é—®é¢˜**: Glueã€Redshiftã€SageMakerè¡€ç¼˜æ•°æ®éš¾ä»¥å…³è”
- **è§£å†³æ–¹æ¡ˆ**: æ™ºèƒ½è¡€ç¼˜åˆå¹¶å¼•æ“Žå’Œè·¨æœåŠ¡å…³è”ç®—æ³•
- **æ•ˆæžœ**: è‡ªåŠ¨åŒ–ç«¯åˆ°ç«¯è¡€ç¼˜æž„å»º

### 4. è¡€ç¼˜æ•°æ®è´¨é‡é—®é¢˜ âœ…
- **é—®é¢˜**: è¡€ç¼˜æ•°æ®ä¸ä¸€è‡´å’Œä¸å®Œæ•´
- **è§£å†³æ–¹æ¡ˆ**: å…¨é¢çš„è¡€ç¼˜éªŒè¯å’Œè´¨é‡ä¿è¯æœºåˆ¶
- **æ•ˆæžœ**: 98%ä»¥ä¸Šçš„è¡€ç¼˜æ•°æ®å®Œæ•´æ€§

## é¡¹ç›®æ–‡ä»¶ç»“æž„

```
enhanced_lineage_agent/
â”œâ”€â”€ agents/                     # æ™ºèƒ½ä»£ç†å®žçŽ°
â”‚   â””â”€â”€ context_aware_agent.py
â”œâ”€â”€ models/                     # æ•°æ®æ¨¡åž‹
â”‚   â”œâ”€â”€ execution_context.py
â”‚   â”œâ”€â”€ job_mapping.py
â”‚   â”œâ”€â”€ lineage_data.py
â”‚   â”œâ”€â”€ lineage_validation.py
â”‚   â””â”€â”€ validation_result.py
â”œâ”€â”€ tools/                      # æ ¸å¿ƒå·¥å…·
â”‚   â”œâ”€â”€ context_extractor.py
â”‚   â”œâ”€â”€ job_validator.py
â”‚   â”œâ”€â”€ lineage_validator.py
â”‚   â”œâ”€â”€ lineage_merger.py
â”‚   â””â”€â”€ log_stream_selector.py
â”œâ”€â”€ utils/                      # å®žç”¨å·¥å…·
â”‚   â”œâ”€â”€ config_manager.py
â”‚   â”œâ”€â”€ monitoring.py
â”‚   â””â”€â”€ error_recovery.py
â””â”€â”€ integrations/               # ç³»ç»Ÿé›†æˆ
    â”œâ”€â”€ enhanced_glue_extractor.py
    â””â”€â”€ compatibility_wrapper.py

config/                         # é…ç½®æ–‡ä»¶
â”œâ”€â”€ config.yaml

examples/                       # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ basic_usage.py
â””â”€â”€ sagemaker_notebook_example.py

tests/                          # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ test_context_aware_agent.py
â””â”€â”€ ...

docs/                           # æ–‡æ¡£
â”œâ”€â”€ CURRENT_STATUS.md
â””â”€â”€ ...

scripts/                        # å·¥å…·è„šæœ¬
â””â”€â”€ setup_project.py
```

## æ€§èƒ½æŒ‡æ ‡

### åŠŸèƒ½æ€§æŒ‡æ ‡
- **ä¸Šä¸‹æ–‡è¯†åˆ«å‡†ç¡®çŽ‡**: >95%
- **Job IDéªŒè¯ç½®ä¿¡åº¦**: >0.9
- **è¡€ç¼˜åˆå¹¶æˆåŠŸçŽ‡**: >98%
- **è·¨æœåŠ¡å…³è”æˆåŠŸçŽ‡**: >90%

### æ€§èƒ½æŒ‡æ ‡
- **ä¸Šä¸‹æ–‡è¯†åˆ«æ—¶é—´**: <5ç§’
- **è¡€ç¼˜éªŒè¯æ—¶é—´**: <30ç§’
- **è¡€ç¼˜åˆå¹¶æ—¶é—´**: <2åˆ†é’Ÿ
- **ç³»ç»Ÿå“åº”æ—¶é—´**: <10ç§’

## ä¸‹ä¸€æ­¥å‘å±•æ–¹å‘

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰
1. é›†æˆåˆ°çŽ°æœ‰è¡€ç¼˜æå–å™¨
2. æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•è¦†ç›–
3. æ–‡æ¡£å®Œå–„å’Œç”¨æˆ·æŒ‡å—

### ä¸­æœŸæ‰©å±•ï¼ˆ1-2ä¸ªæœˆï¼‰
1. å¤šä»£ç†æž¶æž„å®žçŽ°
2. RESTful APIå¹³å°å¼€å‘
3. é«˜çº§æŸ¥è¯¢å’Œå¯è§†åŒ–åŠŸèƒ½

### é•¿æœŸç›®æ ‡ï¼ˆ3-6ä¸ªæœˆï¼‰
1. ä¼ä¸šçº§å®‰å…¨å’Œåˆè§„
2. é«˜å¯ç”¨æ€§å’Œç¾éš¾æ¢å¤
3. æœºå™¨å­¦ä¹ é¢„æµ‹å’Œä¼˜åŒ–

## éƒ¨ç½²å’Œä½¿ç”¨

### å¿«é€Ÿå¼€å§‹
```bash
# 1. é¡¹ç›®è®¾ç½®
python scripts/setup_project.py

# 2. é…ç½®çŽ¯å¢ƒ
cp .env.sample .env
# ç¼–è¾‘.envæ–‡ä»¶

# 3. è¿è¡Œç¤ºä¾‹
python examples/basic_usage.py
python examples/sagemaker_notebook_example.py

# 4. è¿è¡Œæµ‹è¯•
python -m pytest tests/ -v
```

### é›†æˆçŽ°æœ‰ç³»ç»Ÿ
```python
from enhanced_lineage_agent.agents.context_aware_agent import ContextAwareAgent

# åˆå§‹åŒ–ä»£ç†
agent = ContextAwareAgent()

# è¯†åˆ«æ‰§è¡Œä¸Šä¸‹æ–‡
context = agent.identify_execution_context()

# éªŒè¯Job ID
mapping = agent.validate_job_id_selection(job_name, job_run_id, context)

# åˆå¹¶è¡€ç¼˜æ•°æ®
result = agent.merge_lineage_data(lineage_sources, context)
```

## æ€»ç»“

Enhanced Lineage Agenté¡¹ç›®å·²æˆåŠŸå®ŒæˆMVPé˜¶æ®µçš„æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼Œå®žçŽ°äº†ï¼š

1. **å®Œæ•´çš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥æ™ºèƒ½ä»£ç†ç³»ç»Ÿ**
2. **å¤šç»´åº¦Job IDéªŒè¯å’Œæ˜ å°„æœºåˆ¶**
3. **æ™ºèƒ½å¤šæºè¡€ç¼˜éªŒè¯å’Œåˆå¹¶å¼•æ“Ž**
4. **å…¨é¢çš„é…ç½®ç®¡ç†å’Œç›‘æŽ§ç³»ç»Ÿ**
5. **å®Œæ•´çš„ç¤ºä¾‹ã€æµ‹è¯•å’Œæ–‡æ¡£**

è¯¥ç³»ç»Ÿå·²å‡†å¤‡å¥½é›†æˆåˆ°çŽ°æœ‰çš„è¡€ç¼˜ç®¡ç†æµç¨‹ä¸­ï¼Œèƒ½å¤Ÿæœ‰æ•ˆè§£å†³Job IDæ··æ·†å’Œè¡€ç¼˜æ•°æ®äº¤å‰æ±¡æŸ“é—®é¢˜ï¼Œä¸ºç«¯åˆ°ç«¯æ•°æ®è¡€ç¼˜ç®¡ç†æä¾›äº†å¼ºå¤§çš„åŸºç¡€å¹³å°ã€‚

---

*é¡¹ç›®å®Œæˆæ—¶é—´: 2025å¹´1æœˆ*
*ç‰ˆæœ¬: MVP 1.0*
*çŠ¶æ€: å°±ç»ªéƒ¨ç½²*